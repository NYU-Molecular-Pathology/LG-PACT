BootStrap: debootstrap
OSVersion: xenial
MirrorURL: http://us.archive.ubuntu.com/ubuntu/

%setup
    /bin/cp trimmomatic.conda.sh ${SINGULARITY_ROOTFS}/tmp/trimmomatic.sh

%post
    # ~~~~~ BASIC SETUP ~~~~~ #
    apt-get update && \
    apt-get install -y wget \
    bzip2

    # location for misc scripts
    mkdir -p /opt/bin

    # location for misc data
    mkdir -p /data

    # mount point for for NYULMC phoenix (Singluarity)
    mkdir /ifs

    # ~~~~~ MINICONDA ~~~~~ #
    wget https://repo.continuum.io/miniconda/Miniconda3-4.4.10-Linux-x86_64.sh && \
    bash Miniconda3-4.4.10-Linux-x86_64.sh -b -p /conda && \
    rm -f Miniconda3-4.4.10-Linux-x86_64.sh
    conda config --add channels defaults
    conda config --add channels conda-forge
    conda config --add channels bioconda

    # ~~~~~ TRIMMOMATIC ~~~~~ #
    conda install -y -c bioconda trimmomatic trimmomatic=0.36
    /bin/mv /tmp/trimmomatic.sh /opt/bin/trimmomatic.sh 

%environment
    export PATH="/opt/bin:${PATH}"
    export PATH="/opt:${PATH}"
    export PATH="/conda/bin:${PATH}"
    export LC_ALL="C.UTF-8"
    export LANG="C.UTF-8"
